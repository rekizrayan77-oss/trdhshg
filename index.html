<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fus√©e Spatiale</title>
<style>
body {margin:0;padding:0;box-sizing:border-box;height:100vh;overflow:hidden;font-family:Arial,sans-serif;background:linear-gradient(180deg,#000428 0%,#004e92 100%);color:white;}
#gameContainer{position:relative;width:100%;height:100%;display:flex;justify-content:center;align-items:center;}
canvas{display:block;background:radial-gradient(circle at 50% 50%,#001a33 0%,#000 100%);border:3px solid #00d4ff;box-shadow:0 0 30px rgba(0,212,255,0.5);max-width:100%;max-height:100%;}
#screen{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;background:rgba(0,0,0,0.85);z-index:10;padding:20px;}
h1{font-size:48px;margin:20px 0;text-shadow:0 0 20px #00d4ff;animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{transform:scale(1);}50%{transform:scale(1.05);}}
button{padding:15px 40px;margin:10px;font-size:20px;font-weight:bold;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border:none;border-radius:50px;cursor:pointer;transition:all 0.3s ease;box-shadow:0 4px 15px rgba(102,126,234,0.4);}
button:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(102,126,234,0.6);}
button:active{transform:translateY(0);}
input{padding:12px 20px;margin:10px;font-size:18px;border:2px solid #00d4ff;border-radius:25px;background:rgba(255,255,255,0.1);color:white;text-align:center;outline:none;min-width:250px;}
input::placeholder{color:rgba(255,255,255,0.5);}
#scoreDisplay{position:absolute;top:20px;left:20px;font-size:24px;font-weight:bold;text-shadow:0 0 10px #00d4ff;z-index:5;}
#pauseBtn{position:absolute;top:20px;right:20px;padding:10px 20px;font-size:18px;z-index:5;display:none;}
.podium{background:rgba(0,0,0,0.5);padding:20px;border-radius:15px;margin-top:20px;max-height:400px;overflow-y:auto;}
.podium ol{list-style:none;padding:0;margin:10px 0;}
.podium li{padding:10px;margin:5px 0;background:rgba(102,126,234,0.3);border-radius:10px;font-size:18px;}
p{font-size:20px;margin:15px 0;}
</style>
</head>
<body>
<div id="gameContainer">
  <div id="scoreDisplay" style="display:none;">Score: <span id="score">0</span></div>
  <button id="pauseBtn" style="display:none;">‚è∏ Pause</button>
  <div id="screen">
    <h1>üöÄ Fus√©e Spatiale üöÄ</h1>
    <button id="startBtn">D√©marrer</button>
  </div>
  <canvas id="game" width="600" height="800"></canvas>
</div>

<script>
// --- Variables ---
let screen=document.getElementById('screen');
let canvas=document.getElementById('game');
let ctx=canvas.getContext('2d');
let scoreDisplay=document.getElementById('scoreDisplay');
let scoreSpan=document.getElementById('score');
let pauseBtn=document.getElementById('pauseBtn');

let pseudo='',mode='solo',difficulty='easy',score=0,bestScore=0,gameOver=false,gameRunning=false,gamePaused=false,keys={};

let player={x:280,y:740,w:40,h:60,hasShield:false,hasLaser:false};
let asteroids=[],bonuses=[],bullets=[],iaPlayers=[],nextBonusScore=100;

// Bonus images
const imgShield=new Image(); imgShield.src='https://i.ibb.co/WpB4T2L/shield.png';
const imgLaser=new Image(); imgLaser.src='https://i.ibb.co/FbNkWjM/laser.png';
const imgCup=new Image(); imgCup.src='https://i.ibb.co/0mKxTnT/cup.png';

// --- Inputs ---
document.addEventListener('keydown',e=>{
  if(e.target.tagName==='INPUT') return;
  keys[e.key]=true;
  if(gameRunning&&['ArrowLeft','ArrowRight','ArrowUp','ArrowDown'].includes(e.key)) e.preventDefault();
  if(e.code==='Space'&&player.hasLaser) shoot();
});
document.addEventListener('keyup',e=>{if(e.target.tagName==='INPUT') return; keys[e.key]=false;});

// --- Menus ---
document.getElementById('startBtn').addEventListener('click',menuPseudo);
pauseBtn.addEventListener('click',togglePause);

function togglePause(){
  if(gamePaused){
    gamePaused=false; gameRunning=true;
    screen.style.display='none';
    pauseBtn.textContent='‚è∏ Pause';
    requestAnimationFrame(update);
  }else{
    gamePaused=true; pauseBtn.textContent='‚ñ∂ Reprendre';
    showPauseMenu();
  }
}

function showPauseMenu(){
  screen.style.display='flex';
  screen.innerHTML=`<h1>‚è∏ Pause</h1><p style="font-size:32px;color:#00d4ff;">Score: ${score}</p>
    <button id="resumeBtn">‚ñ∂ Reprendre</button>
    <button id="menuPauseBtn">Menu Principal</button>`;
  document.getElementById('resumeBtn').addEventListener('click',togglePause);
  document.getElementById('menuPauseBtn').addEventListener('click',()=>{
    gamePaused=false; gameRunning=false; gameOver=true; pauseBtn.style.display='none'; scoreDisplay.style.display='none';
    asteroids=[];iaPlayers=[];bonuses=[];bullets=[];menuMain();
  });
}

function menuPseudo(){
  screen.innerHTML=`<h1>üöÄ Fus√©e Spatiale üöÄ</h1>
    <p>Entrez votre pseudo:</p>
    <input id="pseudoInput" placeholder="Votre pseudo" maxlength="15"/>
    <button id="validatePseudo">Valider</button>`;
  document.getElementById('validatePseudo').addEventListener('click',setPseudo);
  document.getElementById('pseudoInput').addEventListener('keypress',e=>{if(e.key==='Enter') setPseudo();});
  document.getElementById('pseudoInput').focus();
}

function setPseudo(){pseudo=document.getElementById('pseudoInput').value.trim()||'Joueur'; menuMain();}

function menuMain(){
  screen.innerHTML=`<h1>üöÄ Fus√©e Spatiale üöÄ</h1>
    <p>Bonjour ${pseudo}!</p>
    <button id="soloBtn">Solo</button>
    <button id="multiBtn">Multijoueur</button>`;
  document.getElementById('soloBtn').addEventListener('click',startSolo);
  document.getElementById('multiBtn').addEventListener('click',menuMulti);
}

function menuMulti(){
  screen.innerHTML=`<h1>üöÄ Fus√©e Spatiale üöÄ</h1>
    <p>Choisir la difficult√© de l'IA:</p>
    <button id="easyBtn">Facile</button>
    <button id="mediumBtn">Moyen</button>
    <button id="hardBtn">Difficile</button>`;
  document.getElementById('easyBtn').addEventListener('click',()=>startMulti('easy'));
  document.getElementById('mediumBtn').addEventListener('click',()=>startMulti('medium'));
  document.getElementById('hardBtn').addEventListener('click',()=>startMulti('hard'));
}

// --- Initialisation ---
function startSolo(){mode='solo';initGame();}
function startMulti(diff){mode='multi';difficulty=diff;initGame();}

function initGame(){
  screen.style.display='none'; scoreDisplay.style.display='block'; pauseBtn.style.display='block'; pauseBtn.textContent='‚è∏ Pause';
  gameOver=false; gameRunning=true; gamePaused=false; score=0; scoreSpan.textContent=score;
  asteroids=[]; bonuses=[]; bullets=[]; asteroidSpawnTimer=0; asteroidSpawnInterval=60;
  player={x:280,y:740,w:40,h:60,hasShield:false,hasLaser:false};
  nextBonusScore=100;
  if(mode==='multi') initIA();
  requestAnimationFrame(update);
}

function initIA(){
  iaPlayers=[]; const colors=['#ff6b6b','#ffd93d','#6bcf7f','#a29bfe']; const names=['Astro','Nova','Cosmos','Stellar'];
  for(let i=0;i<4;i++){
    iaPlayers.push({x:100+i*120,y:740,w:40,h:60,color:colors[i],name:names[i],alive:true,direction:0,speed:3,hasShield:false,hasLaser:false});
  }
}

// --- Fonctions de jeu ---
function spawnAsteroid(){
  let size=20+Math.random()*30;
  let speed=2+Math.random()*2+(score/500);
  if(mode==='multi'&&difficulty==='hard') speed+=2;
  asteroids.push({x:Math.random()*(canvas.width-size),y:-size,w:size,h:size,speed:speed});
}

function spawnBonus(){
  let type=Math.floor(Math.random()*3); // 0=shield,1=laser,2=cup
  let img=type===0?imgShield:type===1?imgLaser:imgCup;
  bonuses.push({x:Math.random()*(canvas.width-40),y:-40,w:40,h:40,type:type,img:img});
}

// --- Player/IA movement ---
function movePlayer(){
  if(keys.ArrowLeft && player.x>0) player.x-=6;
  if(keys.ArrowRight && player.x+player.w<canvas.width) player.x+=6;
  if(keys.ArrowUp && player.y>0) player.y-=4;
  if(keys.ArrowDown && player.y+player.h<canvas.height) player.y+=4;
}

function moveIA(){
  iaPlayers.forEach(ai=>{
    if(!ai.alive) return;
    // IA simple avec tentative de ramassage bonus
    let target=null;
    bonuses.forEach(b=>{if(b.y>ai.y-200 && Math.abs(b.x-ai.x)<50) target=b;});
    if(target){
      ai.direction=(target.x>ai.x)?1:-1;
      if(target.y<ai.y) ai.y-=2; else ai.y+=2;
    }else{
      if(difficulty==='easy'){if(Math.random()<0.02) ai.direction=Math.random()<0.5?-1:1;}
      else if(difficulty==='medium'){ai.direction=0;}
      else ai.direction=0;
    }
    ai.x+=ai.direction*ai.speed;
    ai.x=Math.max(0,Math.min(canvas.width-ai.w,ai.x));
  });
}

// --- Dessin ---
function drawRocket(x,y,w,h,color){
  ctx.fillStyle=color; ctx.fillRect(x+w*0.3,y+h*0.3,w*0.4,h*0.6);
  ctx.beginPath(); ctx.moveTo(x+w/2,y); ctx.lineTo(x+w*0.3,y+h*0.3); ctx.lineTo(x+w*0.7,y+h*0.3); ctx.closePath(); ctx.fill();
  ctx.fillStyle='#00d4ff'; ctx.beginPath(); ctx.arc(x+w/2,y+h*0.5,w*0.1,0,Math.PI*2); ctx.fill();
}

function drawPlayer(){drawRocket(player.x,player.y,player.w,player.h,'#00d4ff');}

function drawIA(){iaPlayers.forEach(ai=>{if(ai.alive){drawRocket(ai.x,ai.y,ai.w,ai.h,ai.color); ctx.fillStyle='white'; ctx.font='12px Arial'; ctx.textAlign='center'; ctx.fillText(ai.name,ai.x+ai.w/2,ai.y-5);}});}

function drawAsteroids(){asteroids.forEach(a=>{ctx.fillStyle='#8b8b8b'; ctx.beginPath(); ctx.arc(a.x+a.w/2,a.y+a.h/2,a.w/2,0,Math.PI*2); ctx.fill();});}

function drawBonuses(){bonuses.forEach(b=>{ctx.drawImage(b.img,b.x,b.y,b.w,b.h);});}

function drawBullets(){bullets.forEach(b=>{ctx.fillStyle='red'; ctx.fillRect(b.x,b.y,b.w,b.h);});}

// --- Bullets ---
function shoot(){bullets.push({x:player.x+player.w/2-2.5,y:player.y-10,w:5,h:10,speed:8});}

// --- Collision ---
function checkCollision(a,b){return a.x<b.x+b.w && a.x+a.w>b.x && a.y<b.y+b.h && a.y+a.h>b.y;}

function update(){
  if(!gameRunning || gameOver || gamePaused) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Stars
  ctx.fillStyle='white'; for(let i=0;i<50;i++){let x=(i*137.5)%canvas.width; let y=((i*137.5+score*2)%canvas.height); ctx.fillRect(x,y,2,2);}

  movePlayer(); if(mode==='multi') moveIA();

  // Spawn asteroids
  if(Math.random()<0.02) spawnAsteroid();
  // Spawn bonuses
  if(score>=nextBonusScore){spawnBonus(); nextBonusScore+=110;}

  // Update asteroids
  asteroids.forEach((a,i)=>{a.y+=a.speed;
    if(a.y>canvas.height) {asteroids.splice(i,1); score+=10; scoreSpan.textContent=score;}
    if(checkCollision(player,a) && !player.hasShield) endGame();
  });

  // Update bonuses
  bonuses.forEach((b,i)=>{b.y+=2;
    if(b.y>canvas.height) bonuses.splice(i,1);
    if(checkCollision(player,b)){
      activateBonus(player,b.type); bonuses.splice(i,1);
    }
  });

  // Update bullets
  bullets.forEach((b,i)=>{
    b.y-=b.speed;
    asteroids.forEach((a,j)=>{if(checkCollision(b,a)){asteroids.splice(j,1); bullets.splice(i,1);}});
    if(b.y<0) bullets.splice(i,1);
  });

  drawAsteroids(); drawPlayer(); drawIA(); drawBonuses(); drawBullets();

  if(mode==='solo' && score>=5000){endGameWin();}
  if(mode==='multi') iaPlayers.forEach(ai=>{if(ai.alive && score>=5000){endGameWin();}});

  requestAnimationFrame(update);
}

// --- Bonus activation ---
function activateBonus(p,t){
  if(t===0){p.hasShield=true; setTimeout(()=>p.hasShield=false,30000);}
  if(t===1){p.hasLaser=true; setTimeout(()=>p.hasLaser=false,30000);}
  if(t===2){score+=100; scoreSpan.textContent=score;}
}

// --- End game ---
function endGame(){gameOver=true; gameRunning=false; scoreDisplay.style.display='none'; pauseBtn.style.display='none';
  screen.style.display='flex'; screen.innerHTML=`<h1>Partie termin√©e!</h1><p style="font-size:32px;color:#00d4ff;">Votre Score: ${score}</p>
  <button onclick="menuMain()">Menu principal</button>`;
}

function endGameWin(){gameOver=true; gameRunning=false; scoreDisplay.style.display='none'; pauseBtn.style.display='none';
  screen.style.display='flex'; screen.innerHTML=`<h1>üéâ VICTOIRE! üéâ</h1><p style="font-size:32px;color:#00d4ff;">THE BEST PLAYER OF THE GALAXY</p>
  <button onclick="menuMain()">Menu principal</button>`;
}

</script>
</body>
</html>
